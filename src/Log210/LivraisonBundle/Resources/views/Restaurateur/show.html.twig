{% extends 'Log210LivraisonBundle:Restaurateur:layout.html.twig' %}

{% import 'Log210CommonBundle:Macro:show.html.twig' as show %}

{% use 'Log210CommonBundle:Generic:show.html.twig' %}

{% block title parent() ~ ' - ' ~ entity %}

{% block breadcrumbs %}
    {{ parent() }}
    <li>{{ entity }}</li>
{% endblock %}

{% block fields %}
    {{ show.text(entity, 'name') }}
    {{ show.text(entity, 'description') }}
{% endblock %}

{% block side %}
    {% embed 'Log210CommonBundle:Generic:sidePanel.html.twig' with { title: 'user', entity: entity } only %}
        {% block content %}
            {% embed 'Log210CommonBundle:Generic:ajaxToolbox.html.twig' with { module: 'user', fetch: path('restaurateur_fetch_user', {restaurateur: entity.id}), entity: entity } only %}
                {% block content %}
                    <div class="row">
                        <div ng-if="user != null" >
                            <div ng-class="{disabled: !user.enabled}">
                                <div class="col-xs-4">Username:</div>
                                <div class="col-xs-8 text-right">{{ 'user.username'|ngExpr }}</div>
                                <div class="col-xs-4">Password:</div>
                                <div class="col-xs-8 text-right disabled">*******</div>
                                <div class="col-xs-4">Email:</div>
                                <div class="col-xs-8 text-right">{{ 'user.email'|ngExpr }}</div>
                            </div>
                            <div class="col-xs-12">
                                <label><input type="checkbox" ng-model="user.enabled" ng-change="toggleEnabled()"> Enabled</label>
                            </div>
                        </div>
                        <div ng-if="user == null">
                            <div class="col-lg-12">
                                <a class="btn btn-primary btn-block" ng-click="add()">
                                    <span class="glyphicon glyphicon-plus"></span>
                                    {{ 'newUser'|trans }}
                                </a>
                                <a class="btn btn-success btn-block" ng-click="list()">
                                    <span class="glyphicon glyphicon-user"></span>
                                    {{ 'selectUser'|trans }}
                                </a>
                            </div>
                        </div>
                    </div>
                {% endblock %}
                {% block controller %}
                    $scope.user = null;

                    $scope.fetchSuccess = function (data) {
                        $scope.user = data;
                    };

                    $scope.list = function () {
                        $scope.makeModal('{{ path('restaurateur_makeUserModal_user', {restaurateur: entity.id}) }}', $scope.postModal)();
                    }

                    $scope.add = function () {
                        $scope.makeModal('{{ path('restaurateur_selectModal_user', {restaurateur: entity.id}) }}', $scope.postModal)();
                    };

                    $scope.toggleEnabled = function () {
                        $http.get(Routing.generate('restaurateur_activate_user', {'user': $scope.user.id, 'enabled': ($scope.user.enabled ? 1:0)}));
                    }
                {% endblock %}
            {% endembed %}
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block actions %}
    <a class="btn btn-default glyphicon glyphicon-chevron-left" href="{{ path('restaurateur') }}">{{ 'back'|trans|capitalize }}</a>
    <a
        class="btn btn-warning glyphicon glyphicon-pencil"
        data-toggle="tooltip"
        data-placement="bottom"
        title="{{ 'edit'|trans|capitalize }}"
        href="{{ path('restaurateur_edit', { 'id': entity.id }) }}">
    </a>
{% endblock %}

{% block content %}
    {% if entity.restaurants|length == 0 %}
        <div class="alert alert-warning alert-dismissible" role="alert">
            <span class="glyphicon glyphicon-warning-sign"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <strong>{{ 'warning'|trans|capitalize }}!</strong> {{ 'noRestaurantWarning'|trans|capitalize }}.
        </div>
    {% endif %}
    {{ block('show') }}
{% endblock %}